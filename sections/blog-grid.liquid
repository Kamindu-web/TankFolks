{% comment %}
  Blog Grid Section (robust)
  - Handles blank blog / string-to-number coercion safely
{% endcomment %}

<section class="blog-grid" data-section-id="{{ section.id }}">
    <style>
      #bg-wrap-{{ section.id }} {
        max-width: {% if section.settings.full_width %}none{% else %}{{ section.settings.max_width }}px{% endif %};
        margin: 0 auto;
        padding: 40px {% if section.settings.full_width %}0{% else %}16px{% endif %};
        box-sizing: border-box;
      }
      #bg-wrap-{{ section.id }} h2 {
        font: 700 28px/1.2 "PT Sans", system-ui, Arial;
        margin: 0 0 28px;
      }
  
      .bg-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 24px;
      }
      .bg-card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,.08);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        transition: transform .18s ease, box-shadow .18s ease;
      }
      .bg-card:hover { transform: translateY(-4px); box-shadow: 0 10px 22px rgba(0,0,0,.12); }
  
      .bg-img { width: 100%; padding-top: 56%; position: relative; background: #fafafa; }
      .bg-img img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
  
      .bg-body { padding: 14px 16px 18px; display: flex; flex-direction: column; gap: 8px; }
      .bg-meta { font-size: 13px; color: #777; display: flex; justify-content: space-between; }
      .bg-title { font: 600 17px/1.4 "PT Sans", system-ui, Arial; color: #111; text-decoration: none; }
      .bg-excerpt { font: 14px/1.5 "PT Sans", system-ui, Arial; color: #444; }
    </style>
  
    {% assign chosen_blog = blogs[section.settings.blog] %}
    {% assign limit_int = section.settings.limit | default: 4 | plus: 0 %}
    {% assign article_count = 0 %}
    {% if chosen_blog != blank and chosen_blog.articles_count != blank %}
      {% assign article_count = chosen_blog.articles_count | plus: 0 %}
    {% endif %}
  
    <div id="bg-wrap-{{ section.id }}">
      {% if section.settings.heading != blank %}
        <h2>{{ section.settings.heading }}</h2>
      {% endif %}
  
      {% if chosen_blog != blank and article_count > 0 %}
        <div class="bg-grid">
          {% for article in chosen_blog.articles limit: limit_int %}
            <div class="bg-card">
              <a class="bg-img" href="{{ article.url }}">
                {% if article.image %}
                  <img src="{{ article.image | image_url: width: 800 }}" alt="{{ article.title | escape }}">
                {% endif %}
              </a>
              <div class="bg-body">
                <div class="bg-meta">
                  <span>
                    {% if article.tags and article.tags.size > 0 %}
                      {{ article.tags.first }}
                    {% else %}
                      {{ chosen_blog.title }}
                    {% endif %}
                  </span>
                  <span>{{ article.published_at | date: "%b %e, %Y" }}</span>
                </div>
                <a class="bg-title" href="{{ article.url }}">{{ article.title }}</a>
                {% if section.settings.show_excerpt %}
                  <p class="bg-excerpt">{{ article.excerpt | default: article.content | strip_html | truncate: 120 }}</p>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p style="opacity:.75">
          {% if section.settings.blog == blank %}
            Choose a blog in the section settings.
          {% else %}
            No articles found in the selected blog.
          {% endif %}
        </p>
      {% endif %}
    </div>
  </section>
  
  {% schema %}
  {
    "name": "Blog Grid",
    "enabled_on": { "templates": ["*"] },
    "settings": [
      { "type": "text", "id": "heading", "label": "Section heading", "default": "What's happening now" },
      { "type": "checkbox", "id": "full_width", "label": "Full width", "default": false },
      { "type": "range", "id": "max_width", "min": 800, "max": 1600, "step": 20, "label": "Content max width (px)", "default": 1200 },
      { "type": "blog", "id": "blog", "label": "Choose blog" },
      { "type": "range", "id": "limit", "min": 2, "max": 12, "step": 1, "label": "Posts to show", "default": 4 },
      { "type": "checkbox", "id": "show_excerpt", "label": "Show excerpt", "default": true }
    ],
    "presets": [
      { "name": "Blog Grid", "category": "Blog" }
    ]
  }
  {% endschema %}
  